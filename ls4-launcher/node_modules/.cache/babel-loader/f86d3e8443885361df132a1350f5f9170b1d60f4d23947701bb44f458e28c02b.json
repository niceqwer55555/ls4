{"ast":null,"code":"import \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { BYTE } from './byte';\nimport { FrameImpl } from './frame-impl';\nimport { Parser } from './parser';\nimport { StompSocketState } from './types';\nimport { Versions } from './versions';\nimport { augmentWebsocket } from './augment-websocket';\n/**\n * The STOMP protocol handler\n *\n * Part of `@stomp/stompjs`.\n *\n * @internal\n */\nexport class StompHandler {\n  constructor(_client, _webSocket, config = {}) {\n    this._client = _client;\n    this._webSocket = _webSocket;\n    this._serverFrameHandlers = {\n      // [CONNECTED Frame](http://stomp.github.com/stomp-specification-1.2.html#CONNECTED_Frame)\n      CONNECTED: frame => {\n        this.debug(`connected to server ${frame.headers.server}`);\n        this._connected = true;\n        this._connectedVersion = frame.headers.version;\n        // STOMP version 1.2 needs header values to be escaped\n        if (this._connectedVersion === Versions.V1_2) {\n          this._escapeHeaderValues = true;\n        }\n        this._setupHeartbeat(frame.headers);\n        this.onConnect(frame);\n      },\n      // [MESSAGE Frame](http://stomp.github.com/stomp-specification-1.2.html#MESSAGE)\n      MESSAGE: frame => {\n        // the callback is registered when the client calls\n        // `subscribe()`.\n        // If there is no registered subscription for the received message,\n        // the default `onUnhandledMessage` callback is used that the client can set.\n        // This is useful for subscriptions that are automatically created\n        // on the browser side (e.g. [RabbitMQ's temporary\n        // queues](http://www.rabbitmq.com/stomp.html)).\n        const subscription = frame.headers.subscription;\n        const onReceive = this._subscriptions[subscription] || this.onUnhandledMessage;\n        // bless the frame to be a Message\n        const message = frame;\n        const client = this;\n        const messageId = this._connectedVersion === Versions.V1_2 ? message.headers.ack : message.headers['message-id'];\n        // add `ack()` and `nack()` methods directly to the returned frame\n        // so that a simple call to `message.ack()` can acknowledge the message.\n        message.ack = (headers = {}) => {\n          return client.ack(messageId, subscription, headers);\n        };\n        message.nack = (headers = {}) => {\n          return client.nack(messageId, subscription, headers);\n        };\n        onReceive(message);\n      },\n      // [RECEIPT Frame](http://stomp.github.com/stomp-specification-1.2.html#RECEIPT)\n      RECEIPT: frame => {\n        const callback = this._receiptWatchers[frame.headers['receipt-id']];\n        if (callback) {\n          callback(frame);\n          // Server will acknowledge only once, remove the callback\n          delete this._receiptWatchers[frame.headers['receipt-id']];\n        } else {\n          this.onUnhandledReceipt(frame);\n        }\n      },\n      // [ERROR Frame](http://stomp.github.com/stomp-specification-1.2.html#ERROR)\n      ERROR: frame => {\n        this.onStompError(frame);\n      }\n    };\n    // used to index subscribers\n    this._counter = 0;\n    // subscription callbacks indexed by subscriber's ID\n    this._subscriptions = {};\n    // receipt-watchers indexed by receipts-ids\n    this._receiptWatchers = {};\n    this._partialData = '';\n    this._escapeHeaderValues = false;\n    this._lastServerActivityTS = Date.now();\n    this.configure(config);\n  }\n  get connectedVersion() {\n    return this._connectedVersion;\n  }\n  get connected() {\n    return this._connected;\n  }\n  configure(conf) {\n    // bulk assign all properties to this\n    Object.assign(this, conf);\n  }\n  start() {\n    const parser = new Parser(\n    // On Frame\n    rawFrame => {\n      const frame = FrameImpl.fromRawFrame(rawFrame, this._escapeHeaderValues);\n      // if this.logRawCommunication is set, the rawChunk is logged at this._webSocket.onmessage\n      if (!this.logRawCommunication) {\n        this.debug(`<<< ${frame}`);\n      }\n      const serverFrameHandler = this._serverFrameHandlers[frame.command] || this.onUnhandledFrame;\n      serverFrameHandler(frame);\n    },\n    // On Incoming Ping\n    () => {\n      this.debug('<<< PONG');\n    });\n    this._webSocket.onmessage = evt => {\n      this.debug('Received data');\n      this._lastServerActivityTS = Date.now();\n      if (this.logRawCommunication) {\n        const rawChunkAsString = evt.data instanceof ArrayBuffer ? new TextDecoder().decode(evt.data) : evt.data;\n        this.debug(`<<< ${rawChunkAsString}`);\n      }\n      parser.parseChunk(evt.data, this.appendMissingNULLonIncoming);\n    };\n    this._onclose = closeEvent => {\n      this.debug(`Connection closed to ${this._client.brokerURL}`);\n      this._cleanUp();\n      this.onWebSocketClose(closeEvent);\n    };\n    this._webSocket.onclose = this._onclose;\n    this._webSocket.onerror = errorEvent => {\n      this.onWebSocketError(errorEvent);\n    };\n    this._webSocket.onopen = () => {\n      // Clone before updating\n      const connectHeaders = Object.assign({}, this.connectHeaders);\n      this.debug('Web Socket Opened...');\n      connectHeaders['accept-version'] = this.stompVersions.supportedVersions();\n      connectHeaders['heart-beat'] = [this.heartbeatOutgoing, this.heartbeatIncoming].join(',');\n      this._transmit({\n        command: 'CONNECT',\n        headers: connectHeaders\n      });\n    };\n  }\n  _setupHeartbeat(headers) {\n    if (headers.version !== Versions.V1_1 && headers.version !== Versions.V1_2) {\n      return;\n    }\n    // It is valid for the server to not send this header\n    // https://stomp.github.io/stomp-specification-1.2.html#Heart-beating\n    if (!headers['heart-beat']) {\n      return;\n    }\n    // heart-beat header received from the server looks like:\n    //\n    //     heart-beat: sx, sy\n    const [serverOutgoing, serverIncoming] = headers['heart-beat'].split(',').map(v => parseInt(v, 10));\n    if (this.heartbeatOutgoing !== 0 && serverIncoming !== 0) {\n      const ttl = Math.max(this.heartbeatOutgoing, serverIncoming);\n      this.debug(`send PING every ${ttl}ms`);\n      this._pinger = setInterval(() => {\n        if (this._webSocket.readyState === StompSocketState.OPEN) {\n          this._webSocket.send(BYTE.LF);\n          this.debug('>>> PING');\n        }\n      }, ttl);\n    }\n    if (this.heartbeatIncoming !== 0 && serverOutgoing !== 0) {\n      const ttl = Math.max(this.heartbeatIncoming, serverOutgoing);\n      this.debug(`check PONG every ${ttl}ms`);\n      this._ponger = setInterval(() => {\n        const delta = Date.now() - this._lastServerActivityTS;\n        // We wait twice the TTL to be flexible on window's setInterval calls\n        if (delta > ttl * 2) {\n          this.debug(`did not receive server activity for the last ${delta}ms`);\n          this._closeOrDiscardWebsocket();\n        }\n      }, ttl);\n    }\n  }\n  _closeOrDiscardWebsocket() {\n    if (this.discardWebsocketOnCommFailure) {\n      this.debug('Discarding websocket, the underlying socket may linger for a while');\n      this._discardWebsocket();\n    } else {\n      this.debug('Issuing close on the websocket');\n      this._closeWebsocket();\n    }\n  }\n  forceDisconnect() {\n    if (this._webSocket) {\n      if (this._webSocket.readyState === StompSocketState.CONNECTING || this._webSocket.readyState === StompSocketState.OPEN) {\n        this._closeOrDiscardWebsocket();\n      }\n    }\n  }\n  _closeWebsocket() {\n    this._webSocket.onmessage = () => {}; // ignore messages\n    this._webSocket.close();\n  }\n  _discardWebsocket() {\n    if (!this._webSocket.terminate) {\n      augmentWebsocket(this._webSocket, msg => this.debug(msg));\n    }\n    this._webSocket.terminate();\n  }\n  _transmit(params) {\n    const {\n      command,\n      headers,\n      body,\n      binaryBody,\n      skipContentLengthHeader\n    } = params;\n    const frame = new FrameImpl({\n      command,\n      headers,\n      body,\n      binaryBody,\n      escapeHeaderValues: this._escapeHeaderValues,\n      skipContentLengthHeader\n    });\n    let rawChunk = frame.serialize();\n    if (this.logRawCommunication) {\n      this.debug(`>>> ${rawChunk}`);\n    } else {\n      this.debug(`>>> ${frame}`);\n    }\n    if (this.forceBinaryWSFrames && typeof rawChunk === 'string') {\n      rawChunk = new TextEncoder().encode(rawChunk);\n    }\n    if (typeof rawChunk !== 'string' || !this.splitLargeFrames) {\n      this._webSocket.send(rawChunk);\n    } else {\n      let out = rawChunk;\n      while (out.length > 0) {\n        const chunk = out.substring(0, this.maxWebSocketChunkSize);\n        out = out.substring(this.maxWebSocketChunkSize);\n        this._webSocket.send(chunk);\n        this.debug(`chunk sent = ${chunk.length}, remaining = ${out.length}`);\n      }\n    }\n  }\n  dispose() {\n    if (this.connected) {\n      try {\n        // clone before updating\n        const disconnectHeaders = Object.assign({}, this.disconnectHeaders);\n        if (!disconnectHeaders.receipt) {\n          disconnectHeaders.receipt = `close-${this._counter++}`;\n        }\n        this.watchForReceipt(disconnectHeaders.receipt, frame => {\n          this._closeWebsocket();\n          this._cleanUp();\n          this.onDisconnect(frame);\n        });\n        this._transmit({\n          command: 'DISCONNECT',\n          headers: disconnectHeaders\n        });\n      } catch (error) {\n        this.debug(`Ignoring error during disconnect ${error}`);\n      }\n    } else {\n      if (this._webSocket.readyState === StompSocketState.CONNECTING || this._webSocket.readyState === StompSocketState.OPEN) {\n        this._closeWebsocket();\n      }\n    }\n  }\n  _cleanUp() {\n    this._connected = false;\n    if (this._pinger) {\n      clearInterval(this._pinger);\n    }\n    if (this._ponger) {\n      clearInterval(this._ponger);\n    }\n  }\n  publish(params) {\n    const {\n      destination,\n      headers,\n      body,\n      binaryBody,\n      skipContentLengthHeader\n    } = params;\n    const hdrs = Object.assign({\n      destination\n    }, headers);\n    this._transmit({\n      command: 'SEND',\n      headers: hdrs,\n      body,\n      binaryBody,\n      skipContentLengthHeader\n    });\n  }\n  watchForReceipt(receiptId, callback) {\n    this._receiptWatchers[receiptId] = callback;\n  }\n  subscribe(destination, callback, headers = {}) {\n    headers = Object.assign({}, headers);\n    if (!headers.id) {\n      headers.id = `sub-${this._counter++}`;\n    }\n    headers.destination = destination;\n    this._subscriptions[headers.id] = callback;\n    this._transmit({\n      command: 'SUBSCRIBE',\n      headers\n    });\n    const client = this;\n    return {\n      id: headers.id,\n      unsubscribe(hdrs) {\n        return client.unsubscribe(headers.id, hdrs);\n      }\n    };\n  }\n  unsubscribe(id, headers = {}) {\n    headers = Object.assign({}, headers);\n    delete this._subscriptions[id];\n    headers.id = id;\n    this._transmit({\n      command: 'UNSUBSCRIBE',\n      headers\n    });\n  }\n  begin(transactionId) {\n    const txId = transactionId || `tx-${this._counter++}`;\n    this._transmit({\n      command: 'BEGIN',\n      headers: {\n        transaction: txId\n      }\n    });\n    const client = this;\n    return {\n      id: txId,\n      commit() {\n        client.commit(txId);\n      },\n      abort() {\n        client.abort(txId);\n      }\n    };\n  }\n  commit(transactionId) {\n    this._transmit({\n      command: 'COMMIT',\n      headers: {\n        transaction: transactionId\n      }\n    });\n  }\n  abort(transactionId) {\n    this._transmit({\n      command: 'ABORT',\n      headers: {\n        transaction: transactionId\n      }\n    });\n  }\n  ack(messageId, subscriptionId, headers = {}) {\n    headers = Object.assign({}, headers);\n    if (this._connectedVersion === Versions.V1_2) {\n      headers.id = messageId;\n    } else {\n      headers['message-id'] = messageId;\n    }\n    headers.subscription = subscriptionId;\n    this._transmit({\n      command: 'ACK',\n      headers\n    });\n  }\n  nack(messageId, subscriptionId, headers = {}) {\n    headers = Object.assign({}, headers);\n    if (this._connectedVersion === Versions.V1_2) {\n      headers.id = messageId;\n    } else {\n      headers['message-id'] = messageId;\n    }\n    headers.subscription = subscriptionId;\n    return this._transmit({\n      command: 'NACK',\n      headers\n    });\n  }\n}","map":{"version":3,"names":["BYTE","FrameImpl","Parser","StompSocketState","Versions","augmentWebsocket","StompHandler","constructor","_client","_webSocket","config","_serverFrameHandlers","CONNECTED","frame","debug","headers","server","_connected","_connectedVersion","version","V1_2","_escapeHeaderValues","_setupHeartbeat","onConnect","MESSAGE","subscription","onReceive","_subscriptions","onUnhandledMessage","message","client","messageId","ack","nack","RECEIPT","callback","_receiptWatchers","onUnhandledReceipt","ERROR","onStompError","_counter","_partialData","_lastServerActivityTS","Date","now","configure","connectedVersion","connected","conf","Object","assign","start","parser","rawFrame","fromRawFrame","logRawCommunication","serverFrameHandler","command","onUnhandledFrame","onmessage","evt","rawChunkAsString","data","ArrayBuffer","TextDecoder","decode","parseChunk","appendMissingNULLonIncoming","_onclose","closeEvent","brokerURL","_cleanUp","onWebSocketClose","onclose","onerror","errorEvent","onWebSocketError","onopen","connectHeaders","stompVersions","supportedVersions","heartbeatOutgoing","heartbeatIncoming","join","_transmit","V1_1","serverOutgoing","serverIncoming","split","map","v","parseInt","ttl","Math","max","_pinger","setInterval","readyState","OPEN","send","LF","_ponger","delta","_closeOrDiscardWebsocket","discardWebsocketOnCommFailure","_discardWebsocket","_closeWebsocket","forceDisconnect","CONNECTING","close","terminate","msg","params","body","binaryBody","skipContentLengthHeader","escapeHeaderValues","rawChunk","serialize","forceBinaryWSFrames","TextEncoder","encode","splitLargeFrames","out","length","chunk","substring","maxWebSocketChunkSize","dispose","disconnectHeaders","receipt","watchForReceipt","onDisconnect","error","clearInterval","publish","destination","hdrs","receiptId","subscribe","id","unsubscribe","begin","transactionId","txId","transaction","commit","abort","subscriptionId"],"sources":["../src/stomp-handler.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}